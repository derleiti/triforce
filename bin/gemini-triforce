#!/bin/bash
# gemini-triforce - TriForce Wrapper fÃ¼r Gemini CLI
set -e

GEMINI_BIN=""
for path in /usr/local/bin/gemini ~/.local/bin/gemini $(which gemini 2>/dev/null); do
    [[ -x "$path" ]] && GEMINI_BIN="$path" && break
done

[[ -z "$GEMINI_BIN" ]] && echo "ERROR: gemini nicht gefunden." >&2 && exit 1

WORK_DIR="${TRIFORCE_WORKDIR:-/home/zombie/ailinux-ai-server-backend}"
cd "$WORK_DIR"

[[ -z "$GOOGLE_API_KEY" ]] && [[ -f "$WORK_DIR/.env" ]] && {
    _key=$(grep -E '^GOOGLE_API_KEY=' "$WORK_DIR/.env" 2>/dev/null | head -1)
    [[ -n "$_key" ]] && export "$_key"
}

exec "$GEMINI_BIN" "$@"
