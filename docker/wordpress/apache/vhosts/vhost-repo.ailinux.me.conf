# repo.ailinux.me - AILinux APT Repository
# Proxy zu Docker Container triforce-repo (Port 8443/8080)

<VirtualHost *:80>
    ServerName repo.ailinux.me
    ServerAlias www.repo.ailinux.me
    
    # Redirect to HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>

<VirtualHost *:443>
    ServerName repo.ailinux.me
    ServerAlias www.repo.ailinux.me
    
    # SSL
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/ailinux.me/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/ailinux.me/privkey.pem
    
    # Proxy zu Repository Container (via Docker network)
    ProxyPreserveHost On
    ProxyPass / http://ailinux-repository:8080/
    ProxyPassReverse / http://ailinux-repository:8080/
    
    # Headers
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Port "443"
    
    # Logging
    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 combined
</VirtualHost>
