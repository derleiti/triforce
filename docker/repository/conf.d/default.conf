# AILinux Repository Server Config
# repo.ailinux.me - Fixed 2026-01-02

server {
    listen 8080;
    server_name repo.ailinux.me localhost;

    root /repo;
    autoindex on;
    autoindex_exact_size off;
    autoindex_localtime on;
    autoindex_format html;

    index index.html;
    charset utf-8;

    # CORS Headers f√ºr APT-Clients
    add_header Access-Control-Allow-Origin "*" always;
    add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS" always;
    add_header Access-Control-Allow-Headers "Range, Content-Type" always;

    # Standard Location
    location / {
        try_files $uri $uri/ =404;
    }

    # Mirror-Verzeichnis
    location /mirror/ {
        alias /repo/mirror/;
        autoindex on;
        autoindex_exact_size on;
        autoindex_localtime on;
    }

    # GPG Key Direktzugriff
    location /ailinux.gpg {
        alias /repo/ailinux-archive-key.gpg;
        default_type application/pgp-keys;
    }

    # Add-Repo Script
    location = /add-ailinux-repo.sh {
        alias /repo/mirror/add-ailinux-repo.sh;
        default_type text/plain;
    }

    # Health Check
    location /health {
        access_log off;
        return 200 "OK\n";
        add_header Content-Type text/plain;
    }

    # GPG Keys
    location ~ \.gpg$ {
        default_type application/pgp-keys;
    }

    # Deb/Package Files
    location ~ \.(deb|udeb|dsc|changes)$ {
        expires 7d;
        add_header Cache-Control "public, immutable";
    }

    # Package Index Compression
    location ~* \.(gz|bz2|xz|lz4|zst)$ {
        add_header Content-Encoding identity;
    }
}
