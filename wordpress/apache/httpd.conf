ServerRoot "/usr/local/apache2"

# Logs ins Docker-STDOUT/STDERR
ErrorLog  "/proc/self/fd/2"
LogLevel  warn

# Ports
Listen 80
Listen 443

# Module
LoadModule log_config_module /usr/local/apache2/modules/mod_log_config.so
LoadModule unixd_module /usr/local/apache2/modules/mod_unixd.so
LoadModule mpm_event_module /usr/local/apache2/modules/mod_mpm_event.so
LoadModule authz_core_module /usr/local/apache2/modules/mod_authz_core.so
LoadModule authz_host_module /usr/local/apache2/modules/mod_authz_host.so
LoadModule headers_module /usr/local/apache2/modules/mod_headers.so
LoadModule rewrite_module /usr/local/apache2/modules/mod_rewrite.so
LoadModule proxy_module /usr/local/apache2/modules/mod_proxy.so
LoadModule proxy_http_module /usr/local/apache2/modules/mod_proxy_http.so
LoadModule proxy_fcgi_module /usr/local/apache2/modules/mod_proxy_fcgi.so
LoadModule setenvif_module /usr/local/apache2/modules/mod_setenvif.so
LoadModule env_module /usr/local/apache2/modules/mod_env.so
LoadModule mime_module /usr/local/apache2/modules/mod_mime.so
LoadModule ssl_module /usr/local/apache2/modules/mod_ssl.so
LoadModule socache_shmcb_module /usr/local/apache2/modules/mod_socache_shmcb.so
LoadModule http2_module /usr/local/apache2/modules/mod_http2.so
LoadModule dir_module /usr/local/apache2/modules/mod_dir.so
LoadModule alias_module /usr/local/apache2/modules/mod_alias.so
LoadModule remoteip_module /usr/local/apache2/modules/mod_remoteip.so

# SSL-Session Cache (Container-Pfad!)
SSLSessionCache         shmcb:/usr/local/apache2/logs/ssl_scache(512000)
SSLSessionCacheTimeout  300

ServerName localhost

# DocumentRoot disabled for reverse proxy setup (Flarum)
# Uncomment for WordPress setup:
#DocumentRoot "/var/www/html"
TypesConfig conf/mime.types
#<Directory "/var/www/html">
#  AllowOverride All
#  Require all granted
#</Directory>

# Security-Header global
<IfModule mod_headers.c>
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Schnipsel & Extras
IncludeOptional conf.d/snippets/*.conf
IncludeOptional conf.d/extra/*.conf

# Cloudflare Allowlist + Real-IP Logging
Include conf/cloudflare-allowlist.conf

# DirectoryIndex
DirectoryIndex index.php index.html

# PHP-FPM Handler (disabled for Flarum - using reverse proxy to app container)
# Uncomment for WordPress setup:
#<FilesMatch \.php$>
#  SetHandler "proxy:fcgi://wordpress_fpm:9000"
#</FilesMatch>

# Docker-User
User www-data
Group www-data

# Protokolle: HTTP/2 + 1.1
Protocols h2 http/1.1

# TLS-Policy
SSLProtocol             all -SSLv3 -TLSv1 -TLSv1.1
SSLCipherSuite          HIGH:!aNULL:!MD5
SSLHonorCipherOrder     on
SSLVerifyClient none

# Logging: nutze das Real-IP-Format aus cloudflare-allowlist.conf
CustomLog "/proc/self/fd/1" realip

# vHosts laden
Include conf/vhosts/*.conf
