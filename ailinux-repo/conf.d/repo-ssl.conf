server {
    listen 8443 ssl;
    listen [::]:8443 ssl;
    http2 on;
    
    server_name repo.ailinux.me ailinux.me www.ailinux.me;
    root /repo;
    index index.html;

    # --- SSL KONFIGURATION (DAS FEHLTE) ---
    ssl_certificate     /etc/letsencrypt/live/ailinux.me/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/ailinux.me/privkey.pem;
    
    ssl_session_cache   shared:SSL:10m;
    ssl_session_timeout 1d;
    ssl_protocols       TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers off;
    # --------------------------------------

    # Live-HTML-Log: kein Caching (Damit du den Fortschritt siehst)
    location = /mirror/live-log.html {
        autoindex off;
        try_files $uri =404;
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
    }

    # Metadaten, Keys und Skripte NICHT cachen (WICHTIG!)
    location ~ /(Release|InRelease|Packages|Packages\.(gz|bz2)|Contents|Sources|Components|.*\.gpg|.*\.asc|.*\.sh)$ {
        autoindex on;
        try_files $uri $uri/ =404;
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    # Standard Cache f√ºr .deb Dateien (langfristig cachen)
    location / {
        autoindex on;
        try_files $uri $uri/ =404;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
