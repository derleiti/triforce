# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘           ğŸ³ TRIFORCE DOCKER SERVICES v4.0                                   â•‘
# â•‘           Alle Container nutzen config/triforce.env                          â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Starten: docker compose up -d
# Mit Profiles: docker compose --profile wordpress --profile searxng up -d
# Alle: docker compose --profile wordpress --profile searxng --profile mailserver --profile repo up -d

version: '3.8'

services:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # WORDPRESS + MYSQL (Hauptseite)
  # URL: ${WORDPRESS_URL} (z.B. https://ailinux.me)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  wordpress:
    container_name: ${WORDPRESS_CONTAINER_NAME:-triforce-wordpress}
    image: ${WORDPRESS_IMAGE:-wordpress:latest}
    restart: unless-stopped
    ports:
      - "${WORDPRESS_HTTP_PORT:-8080}:80"
    environment:
      WORDPRESS_DB_HOST: ${WORDPRESS_DB_HOST:-db}
      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME:-wordpress}
      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER:-wordpress}
      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
      WORDPRESS_CONFIG_EXTRA: |
        define('WP_HOME', '${WORDPRESS_URL}');
        define('WP_SITEURL', '${WORDPRESS_URL}');
        define('FORCE_SSL_ADMIN', true);
    volumes:
      - ./wordpress/html:/var/www/html
    depends_on:
      - db
    networks:
      - triforce-net
    profiles:
      - wordpress

  db:
    container_name: ${MYSQL_CONTAINER_NAME:-triforce-mysql}
    image: ${MYSQL_IMAGE:-mysql:8.0}
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${WORDPRESS_DB_NAME:-wordpress}
      MYSQL_USER: ${WORDPRESS_DB_USER:-wordpress}
      MYSQL_PASSWORD: ${WORDPRESS_DB_PASSWORD}
    volumes:
      - ./data/mysql:/var/lib/mysql
    networks:
      - triforce-net
    profiles:
      - wordpress

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # SEARXNG (Meta-Suchmaschine)
  # URL: ${SEARCH_URL} (z.B. https://search.ailinux.me)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  searxng:
    container_name: ${SEARXNG_CONTAINER_NAME:-triforce-searxng}
    image: ${SEARXNG_IMAGE:-searxng/searxng:latest}
    restart: unless-stopped
    ports:
      - "${SEARXNG_PORT:-8888}:8080"
    environment:
      SEARXNG_SECRET: ${SEARXNG_SECRET_KEY}
      SEARXNG_BASE_URL: ${SEARCH_URL}
    volumes:
      - ./searxng:/etc/searxng
    networks:
      - triforce-net
    profiles:
      - searxng

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # REPOSITORY (Debian/Ubuntu APT Repository)
  # URL: ${REPO_URL} (z.B. https://repo.ailinux.me)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  repo:
    container_name: ${REPO_CONTAINER_NAME:-triforce-repo}
    image: ${REPO_IMAGE:-nginx:alpine}
    restart: unless-stopped
    ports:
      - "${REPO_HTTP_PORT:-8081}:80"
    volumes:
      - ./repo/mirror:/usr/share/nginx/html:ro
      - ./repo/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - triforce-net
    profiles:
      - repo

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # MAILSERVER (docker-mailserver)
  # URL: ${MAIL_DOMAIN} (z.B. mail.ailinux.me)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  mailserver:
    container_name: ${MAILSERVER_CONTAINER_NAME:-triforce-mailserver}
    image: ${MAILSERVER_IMAGE:-docker.io/mailserver/docker-mailserver:latest}
    restart: unless-stopped
    hostname: ${MAILSERVER_HOSTNAME}
    domainname: ${TRIFORCE_DOMAIN}
    ports:
      - "${MAIL_SMTP_PORT:-25}:25"
      - "${MAIL_SUBMISSION_PORT:-587}:587"
      - "${MAIL_SMTPS_PORT:-465}:465"
      - "${MAIL_IMAP_PORT:-143}:143"
      - "${MAIL_IMAPS_PORT:-993}:993"
    environment:
      ENABLE_CLAMAV: ${MAILSERVER_ENABLE_CLAMAV:-0}
      ENABLE_SPAMASSASSIN: ${MAILSERVER_ENABLE_SPAMASSASSIN:-1}
      ENABLE_FAIL2BAN: ${MAILSERVER_ENABLE_FAIL2BAN:-1}
      SSL_TYPE: letsencrypt
      PERMIT_DOCKER: network
    volumes:
      - ./mailserver/data:/var/mail
      - ./mailserver/state:/var/mail-state
      - ./mailserver/logs:/var/log/mail
      - ./mailserver/config:/tmp/docker-mailserver
      - /etc/letsencrypt:/etc/letsencrypt:ro
    cap_add:
      - NET_ADMIN
    networks:
      - triforce-net
    profiles:
      - mailserver

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # REDIS (Caching fÃ¼r Backend)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  redis:
    container_name: ${REDIS_CONTAINER_NAME:-triforce-redis}
    image: redis:alpine
    restart: unless-stopped
    ports:
      - "${REDIS_PORT:-6379}:6379"
    volumes:
      - ./data/redis:/data
    command: redis-server --appendonly yes
    networks:
      - triforce-net
    profiles:
      - redis

networks:
  triforce-net:
    driver: bridge
